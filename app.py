from flask import Flask, request
from flask_restful import Resource, Api
import json
import io
import reverse_geocoder as rg

geo = rg.RGeocoder(mode=2, verbose=True, stream=io.StringIO(open('vidkomustadir.csv', encoding='utf-8').read()))
coords = [(64.14919656727183,-21.887991125666854),(64.14751073772668,-21.8861888179947),(64.14565782699381,-21.886561100224853),(64.1515058615645,-21.881677200896917),(64.14992339147369,-21.879366075544585),(64.14813402438833,-21.878073271468793),(64.14625973029054,-21.877886710302946),(64.14442824339218,-21.87881888610103),(64.15612363091856,-21.869046199412693),(64.1546069840265,-21.866497455355464),(64.1529582544323,-21.86442488369208),(64.15120567325799,-21.862863885456562),(64.14937924438563,-21.861841085804233),(64.14751022994339,-21.86137388418135),(64.14563061462506,-21.86147016350435),(64.14377255806144,-21.86212816285125),(64.141967844638,-21.863336515330083),(64.16535589064323,-21.843771584231195),(64.16387515503791,-21.841109410743293),(64.16232167051925,-21.838675442454182),(64.16070210098957,-21.836480081071567),(64.15902339264174,-21.834532699758693),(64.15729274402715,-21.832841603474808),(64.15551757505831,-21.831413993997515),(64.15370549508171,-21.830255939767532),(64.15186427016023,-21.829372350671957),(64.15000178970763,-21.828766957861927),(64.14812603261969,-21.82844229867598),(64.14624503304854,-21.828399706717747),(64.14436684596765,-21.82863930711533),(64.1424995126758,-21.829160016965286),(64.14065102638708,-21.829959550942483),(64.13882929805465,-21.831034432036148),(64.13704212257316,-21.832380007348316),(64.18380727767843,-21.793171869557607),(64.18234458517153,-21.79045495500539),(64.1808439149006,-21.787849671128015),(64.17930687985464,-21.785358799845824),(64.17773513183724,-21.78298499876782),(64.17613035967254,-21.780730798387776),(64.17449428737203,-21.778598599425017),(64.17282867226463,-21.776590670310163),(64.17113530309167,-21.774709144820566),(64.16941599806962,-21.772956019866513),(64.16767260292194,-21.771333153429932),(64.16590698888274,-21.769842262658507),(64.16412105067454,-21.768484922116215),(64.16231670446194,-21.76726256219213),(64.16049588578385,-21.76617646766781),(64.15866054746641,-21.76522777644597),(64.15681265751891,-21.76441747844011),(64.15495419701502,-21.76374641462624),(64.15308715796168,-21.763215276257164),(64.15121354115783,-21.76282460423958),(64.14933535404569,-21.762574788674787),(64.14745460855625,-21.76246606856187),(64.14557331895202,-21.762498531664193),(64.14369349966891,-21.76267211453788),(64.14181716315963,-21.76298660272307),(64.13994631774109,-21.763441631095137),(64.13808296544784,-21.76403668437776),(64.136229099894,-21.764771097813536),(64.13438670414591,-21.765644057994283),(64.13255774860784,-21.766654603846444),(64.13074418892255,-21.767801627772947),(64.12894796388969,-21.7690838769471),(64.12717099340334,-21.77049995475924),(64.22065739001309,-21.69177021974829),(64.21920247575815,-21.689027501144245),(64.21772818921178,-21.686340170714676),(64.21623492813907,-21.683708944588588),(64.21472309535943,-21.681134523414602),(64.21319309863551,-21.67861759217824),(64.21164535056083,-21.676158820023126),(64.21008026844603,-21.673758860077328),(64.20849827420409,-21.671418349283513),(64.20689979423412,-21.66913790823558),(64.2052852593043,-21.666918141018368),(64.20365510443348,-21.66475963505376),(64.20200976877162,-21.662662960950264),(64.20034969547949,-21.660628672358794),(64.19867533160705,-21.65865730583271),(64.19698712797108,-21.656749380693284),(64.19528553903167,-21.654905398899324),(64.1935710227679,-21.6531258449232),(64.19184404055268,-21.651411185630742),(64.19010505702674,-21.64976187016686),(64.18835453997175,-21.648178329846317),(64.18659296018274,-21.64666097804891),(64.18482079133977,-21.645210210120947),(64.18303850987898,-21.643826403280787),(64.18124659486288,-21.642509916530418),(64.17944552785008,-21.64126109057126),(64.17763579276443,-21.640080247726317),(64.17581787576371,-21.638967691866608),(64.1739922651076,-21.63792370834325),(64.17215945102544,-21.636948563924275),(64.17031992558339,-21.636042506737628),(64.16847418255118,-21.63520576621804),(64.16662271726872,-21.634438553060413),(64.16476602651213,-21.633741059177183),(64.1629046083596,-21.633113457662173),(64.16103896205706,-21.63255590275844),(64.15916958788358,-21.632068529831926),(64.1572969870166,-21.631651455350564),(64.15542166139703,-21.631304776867726),(64.15354411359422,-21.6310285730113),(64.15166484667105,-21.630822903478307),(64.14978436404873,-21.630687809033596),(64.14790316937176,-21.630623311515),(64.14602176637297,-21.63062941384222),(64.14414065873858,-21.630706100031773),(64.14226034997331,-21.630853335216234),(64.14038134326594,-21.631071065669666),(64.13850414135467,-21.631359218836444),(64.13662924639297,-21.63171770336656),(64.13475715981568,-21.63214640915471),(64.13288838220524,-21.632645207385476),(64.13102341315846,-21.633213950582185),(64.12916275115359,-21.63385247266146),(64.12730689341768,-21.634560588992564),(64.12545633579461,-21.6353380964612),(64.12361157261324,-21.63618477353833),(64.12177309655658,-21.637100380353438),(64.11994139853101,-21.638084658773312),(64.11811696753625,-21.6391373324844),(64.11630029053612,-21.640258107080605),(64.11449185232964,-21.641446670155336),(64.112692135423,-21.642702691398366),(64.11090161990221,-21.64402582269682),(64.10912078330635,-21.645415698241),(64.10735010050182,-21.64687193463464),(64.29414590733559,-21.488155779874546),(64.29269204545147,-21.48540275616392),(64.29122841179876,-21.482677534933842),(64.28975510588815,-21.479980297019136),(64.28827222787189,-21.477311221265097),(64.28677987853655,-21.47467048451576),(64.28527815929598,-21.47205826160269),(64.28376717218401,-21.469474725333733),(64.28224701984723,-21.466920046482276),(64.28071780553776,-21.46439439377619),(64.27917963310585,-21.461897933887425),(64.27763260699264,-21.459430831421447),(64.27607683222267,-21.45699324890673),(64.27451241439648,-21.45458534678491),(64.27293945968316,-21.452207283400895),(64.27135807481285,-21.44985921499289),(64.2697683670692,-21.447541295682644),(64.26817044428181,-21.445253677466262),(64.26656441481859,-21.442996510204967),(64.26495038757822,-21.440769941615837),(64.26332847198238,-21.438574117262725),(64.26169877796808,-21.436409180548043),(64.26006141598005,-21.43427527270358),(64.25841649696275,-21.432172532782378),(64.25676413235281,-21.430101097650365),(64.2551044340711,-21.428061101978642),(64.25343751451489,-21.426052678235223),(64.25176348654998,-21.424075956677207),(64.25008246350284,-21.422131065343653),(64.24839455915264,-21.42021813004793),(64.24669988772332,-21.41833727437073),(64.24499856387563,-21.416488619652608),(64.24329070269901,-21.414672284987766),(64.24157641970378,-21.412888387216768),(64.23985583081287,-21.411137040920593),(64.23812905235393,-21.409418358413735),(64.23639620105105,-21.407732449738607),(64.23465739401682,-21.406079422659214),(64.2329127487441,-21.404459382655272),(64.23116238309784,-21.402872432917103),(64.22940641530698,-21.401318674339638),(64.22764496395622,-21.399798205517325),(64.22587814797775,-21.398311122739035),(64.22410608664312,-21.396857519983396),(64.2223288995549,-21.395437488913483),(64.22054670663844,-21.394051118872653),(64.21875962813367,-21.39269849688007),(64.21696778458664,-21.39137970762632),(64.21517129684133,-21.390094833469554),(64.2133702860313,-21.388843954431508),(64.21156487357135,-21.387627148193847),(64.20975518114912,-21.386444490094398),(64.20794133071678,-21.385296053124186),(64.20612344448261,-21.384181907923796),(64.2043016449027,-21.383102122780805),(64.20247605467239,-21.382056763626426),(64.20064679671808,-21.38104589403349),(64.19881399418855,-21.380069575213174),(64.19697777044678,-21.379127866013263),(64.19513824906136,-21.37822082291573),(64.19329555379814,-21.377348500034685),(64.19144980861168,-21.376510949114955),(64.18960113763691,-21.37570821952974),(64.1877496651806,-21.3749403582798),(64.18589551571289,-21.37420740999173),(64.18403881385886,-21.37350941691693),(64.18217968439004,-21.372846418930703),(64.18031825221593,-21.372218453531435),(64.1784546423755,-21.371625555839774),(64.17658898002875,-21.371067758598233),(64.17472139044823,-21.37054509217109),(64.17285199901052,-21.370057584543957),(64.17098093118773,-21.369605261323922),(64.16910831253911,-21.369188145739724),(64.16723426870247,-21.368806258642152),(64.16535892538572,-21.368459618504488),(64.16348240835848,-21.36814824142318),(64.16160484344346,-21.367872141118696),(64.1597263565081,-21.367631328936493),(64.15784707345607,-21.36742581384839),(64.15596712021876,-21.367255602453344),(64.15408662274692,-21.36712069897982),(64.1522057070021,-21.36702110528638),(64.15032449894825,-21.36695682086444),(64.14844312454332,-21.36692784283949),(64.14656170973076,-21.366934165973742),(64.14468038043113,-21.366975782668167),(64.14279926253363,-21.36705268296462),(64.14091848188781,-21.36716485454922),(64.13903816429504,-21.367312282754366),(64.13715843550023,-21.3674949505617),(64.13527942118334,-21.367712838605765),(64.13340124695112,-21.36796592517635),(64.13152403832869,-21.368254186222558),(64.12964792075122,-21.36857759535586),(64.12777301955563,-21.368936123853864),(64.12589945997216,-21.36932974066428),(64.12402736711624,-21.36975841240879),(64.12215686598002,-21.370222103386915),(64.12028808142423,-21.37072077558049),(64.11842113816988,-21.37125438865825),(64.11655616079001,-21.371822899980003),(64.11469327370145,-21.372426264601305),(64.11283260115663,-21.37306443527855),(64.11097426723539,-21.373737362474166),(64.1091183958368,-21.374444994360786),(64.10726511067105,-21.375187276827766),(64.10541453525117,-21.37596415348544),(64.10356679288513,-21.37677556567156),(64.10172200666754,-21.37762145245627),(64.09988029947169,-21.378501750648404),(64.09804179394149,-21.379416394801414),(64.09620661248339,-21.380365317219045),(64.09437487725836,-21.381348447962075),(64.092546710174,-21.3823657148544),(64.09072223287646,-21.383417043489576),(64.08890156674252,-21.384502357237494),(64.08708483287174,-21.38562157725114),(64.08527215207849,-21.386774622473492),(64.0834636448841,-21.387961409644447),(64.08165943150907,-21.389181853308255),(64.0798596318651,-21.390435865820425),(64.07806436554755,-21.391723357355584),(64.07627375182737,-21.393044235914584),(64.07448790964364,-21.394398407332446),(64.07270695759561,-21.3957857752862),(64.07093101393525,-21.397206241302513),(64.06916019655945,-21.39865970476594),(64.0673946230024,-21.40014606292736)]
# {64.14919656727183,-21.887991125666854},{64.14751073772668,-21.8861888179947}
print(geo.query(coords)[0])

app = Flask(__name__)
api = Api(app)

class ReverseGeocoder(Resource):
    def get(self, coordinates):
        print(coordinates)
        print(tuple(item.split(",") for item in coordinates.split(";")))
        # json_string = json.dumps(geo.query(coordinates)[0], ensure_ascii=False)
        # print(json.loads(json_string))
        # return {'hello': json.loads(json_string)}
        return {'coordinates': geo.query(tuple(item.split(",") for item in coordinates.split(";")))}

# class Departmental_Salary(Resource):
#     def get(self, department_name):
#         conn = e.connect()
#         query = conn.execute("select * from salaries where Department='%s'"%department_name.upper())
#         #Query the result and get cursor.Dumping that data to a JSON is looked by extension
#         result = {'data': [dict(zip(tuple (query.keys()) ,i)) for i in query.cursor]}
#         return result
#         #We can have PUT,DELETE,POST here. But in our API GET implementation is sufficient

# api.add_resource(Departmental_Salary, '/dept/<string:department_name>')
api.add_resource(ReverseGeocoder, '/reversegeocode/<string:coordinates>')

if __name__ == '__main__':
     app.run()
